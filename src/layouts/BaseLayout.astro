---
import { SEO } from 'astro-seo';
import { ClientRouter } from 'astro:transitions';

import '~/styles/app.css';

type meta = {
  title?: string;
  description?: string;
  image?: string;
};

export type Props = {
  meta?: meta;
};

const { meta } = Astro.props;

const title = meta?.title || 'Manhole Gallery';
const description =
  meta?.description ||
  'Mahole Gallery, the Pavement Chronicles. An image gallery of manhole covers from around the world.';
const image =
  meta?.image || 'https://manhole.gallery/manhole-gallery-social-image.webp';
---

<html lang="en" class="flex min-h-full flex-col">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width" />
    <link rel="sitemap" href="/sitemap-index.xml" />

    <SEO
      title={title}
      description={description}
      openGraph={{
        basic: {
          title,
          type: 'A type.',
          image,
        },
      }}
      twitter={{
        creator: '@wrux',
      }}
      extend={{
        meta: [
          {
            name: 'twitter:image',
            content: image,
          },
          { name: 'twitter:title', content: title },
          { name: 'twitter:description', content: description },
        ],
      }}
    />

    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png" />
    <link rel="icon" type="image/svg+xml" sizes="32x32" href="/favicon.svg" />
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png" />
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png" />
    <link rel="manifest" href="/site.webmanifest" />
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#f39f5a" />
    <meta name="msapplication-TileColor" content="#f39f5a" />
    <meta name="theme-color" content="#000000" />

    <ClientRouter />

    <script>
      // Check if view transitions are supported
      if (typeof document.startViewTransition === 'undefined') {
        console.warn(
          'View Transitions API is not supported in this browser. View transitions will not work.'
        );
      }

      // Debug view transitions in development
      if (import.meta.env.DEV) {
        document.addEventListener('astro:page-load', () => {
          console.log('âœ… View transition completed');
        });

        document.addEventListener('astro:before-preparation', () => {
          console.log('ðŸ”„ View transition starting');
        });

        document.addEventListener('astro:after-swap', () => {
          console.log('âœ¨ View transition swap completed');
        });
      }
    </script>
  </head>
  <body
    class="flex min-h-full max-w-[100vw] flex-1 flex-col bg-surface text-white antialiased"
  >
    <slot />
  </body>
</html>
