---
import { getCountries, getCountryList } from '~/sanity/queries';
import PageLayout from '~/layouts/PageLayout.astro';
import { CountryShape, PostTeaser } from '~/components';

export async function getStaticPaths() {
  const countries = await getCountries();
  return countries.map((country) => ({
    params: { slug: country.slug },
    props: country,
  }));
}

const countries = await getCountryList();

export type Props = Country;

const country = Astro.props;
---

<PageLayout
  meta={{
    title: `${country.name} | Manhole Gallery`,
  }}
>
  <article class="container mb-20 lg:mb-24">
    <div class="mx-auto max-w-4xl">
      <div class="mb-16 text-center">
        <div class="mb-8 flex justify-center">
          {
            country?.countryCode && (
              <CountryShape
                countryCode={country.countryCode}
                class:list="mx-auto max-w-full"
                transition:name={`country_${country._id}`}
              />
            )
          }
        </div>
        <div class="space-y-3">
          <h1 class="type-h1">{country.name}</h1>
          {
            country.nameLocalised && (
              <p class="type-h3 text-current/70">
                {country.nameLocalised}
              </p>
            )
          }
        </div>
      </div>

      {
        countries && countries.filter(({ _id }) => _id != country._id).length > 0 && (
          <div class="mb-16">
            <div class="mb-4 flex justify-center">
              <div class="h-px w-12 bg-current/20"></div>
            </div>
            <div class="flex flex-wrap justify-center gap-2 md:gap-3">
              {
                countries
                  .filter(({ _id }) => _id != country._id)
                  .map((c) => (
                    <a
                      class="type-sm rounded-full border border-current/20 px-4 py-2 transition-all hover:border-secondary hover:bg-secondary/10"
                      href={`/country/${c.slug}`}
                      aria-label={`View all posts in ${c.name}`}
                      transition:name={`country_list_${c._id}`}
                    >
                      {c.name}
                    </a>
                  ))
              }
            </div>
          </div>
        )
      }
    </div>

    {
      country?.posts && country.posts.length > 0 && (
        <div class="gallery-grid w-full px-4 sm:px-6 lg:px-8 xl:px-12">
          {country.posts.map((post, index) => (
            <PostTeaser
              imageSizes="(max-width: 474px) 100vw, (max-width: 1023px) 50vw, (max-width: 125rem) 33.334vw, 40rem"
              post={post}
              lazy={index >= 6}
            />
          ))}
        </div>
      )
    }
  </article>
</PageLayout>
