---
import { getPostTeasers } from '~/sanity/queries';
import PageLayout from '~/layouts/PageLayout.astro';
import { PostTeaser } from '~/components';

const posts = await getPostTeasers();
---

<PageLayout>
  <div class="container mb-16 md:mb-20 lg:mb-24">
    <div class="mx-auto max-w-4xl text-center">
      <h1 class="type-h1 mb-6 md:mb-8" transition:name="home-title">
        <span class="sr-only">Manhole Gallery</span>
        <span class="block">The Pavement</span>
        <span
          class="block bg-linear-to-r from-secondary to-tertiary bg-clip-text text-transparent"
          >Chronicles</span
        >
      </h1>
      <p class="type-lg mb-8 leading-relaxed text-current/80 md:mb-12" transition:name="home-description">
        Discover the <em class="not-italic font-semibold text-secondary"
          >unseen</em
        > artistry of manhole covers from cities around the world. Each design tells
        a story of culture, craftsmanship, and the beauty found in everyday infrastructure.
      </p>
    </div>
  </div>

  <div class="gallery-grid w-full" transition:name="home-gallery-grid">
    {
      posts.map((post, index) => (
        <PostTeaser
          imageSizes="(max-width: 474px) 100vw, (max-width: 1023px) 50vw, (max-width: 125rem) 33.334vw, 40rem"
          post={post}
          lazy={index >= 6}
        />
      ))
    }
    {
      posts.length % 3 !== 0 && (
        <div class="col-span-[-1] teaser-placeholder hidden flex-col items-center justify-center space-y-6 rounded-lg border-2 border-dashed border-current/20 bg-surface/50 p-12 text-center">
          <div class="manhole-accent">
            <div class="h-16 w-16 rounded-full border-4 border-current" />
          </div>
          <p class="type-h4">Feel free to contribute</p>
          <p class="type-sm text-current/70 max-w-md">
            Have a manhole cover design you'd like to share? We'd love to
            feature it!
          </p>
          <a href="mailto:callum@wrux.com" class="button">
            <span>Get in Touch</span>
          </a>
        </div>
      )
    }
  </div>
</PageLayout>

<style>
  .teaser-placeholder:nth-child(3n):nth-last-of-type(1) {
    @screen xs {
      display: flex;
    }
  }

  .teaser-placeholder:nth-child(3n-1):nth-last-of-type(1) {
    grid-column: span 1;

    @screen xs {
      display: flex;
    }

    @screen lg {
      grid-column: span 2;
    }
  }

  .teaser-placeholder:nth-child(3n-2):nth-last-of-type(1) {
    grid-column: span 3;

    @screen xs {
      display: flex;
    }
  }
</style>
